<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ilich Code - Interactive Art Section</title>
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background-color: #000;
            color: #fff;
            overflow-x: hidden;
        }
        .ilich-section {
            padding: 50px;
            text-align: center;
            background: linear-gradient(45deg, #ff0066, #00ccff);
        }
        .ilich-section h2 {
            font-size: 2.5em;
            text-transform: uppercase;
            text-shadow: 2px 2px #000;
            margin-bottom: 20px;
        }
        .ilich-section p {
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        .canvas-container {
            position: relative;
            width: 600px;
            height: 400px;
            margin: 0 auto;
            border: 2px solid #fff;
            background: #222;
            overflow: hidden;
        }
        #imageCanvas {
            display: block;
            max-width: 100%;
            max-height: 100%;
        }
        .icon-tray {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .icon {
            width: 50px;
            height: 50px;
            cursor: move;
            transition: transform 0.3s;
            user-drag: none; /* Prevent default browser drag behavior */
            -webkit-user-drag: none;
        }
        .icon:hover {
            transform: scale(1.2);
        }
        .icon.dragging {
            opacity: 0.7;
        }
        .upload-btn {
            background: #ff0066;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            margin-bottom: 20px;
            transition: background 0.3s;
        }
        .upload-btn:hover {
            background: #00ccff;
        }
        @media (max-width: 768px) {
            .ilich-section {
                padding: 20px;
            }
            .canvas-container {
                width: 100%;
                height: 300px;
            }
            .ilich-section h2 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <div class="ilich-section">
        <h2>Ilich Code Art Studio</h2>
        <p>Upload your photo and customize it with our punk-rave icons!</p>
        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
        <button class="upload-btn" onclick="document.getElementById('imageUpload').click()">Upload Your Image</button>
        <div class="canvas-container">
            <canvas id="imageCanvas" width="600" height="400"></canvas>
        </div>
        <div class="icon-tray">
            <img src="images/Logo/Cosmic_Rejex_Largerk.png class="icon" alt="Star Icon" data-icon="star" draggable="true">
            <img src="images/Logo/Cosmic_Rejex_Largerk.png" class="icon" alt="Lightning Icon" data-icon="lightning" draggable="true">
            <img src="assets/images/skull.png" class="icon" alt="Skull Icon" data-icon="skull" draggable="true">
        </div>
    </div>

    <script>
        const canvas = document.getElementById('imageCanvas');
        const ctx = canvas.getContext('2d');
        const imageUpload = document.getElementById('imageUpload');
        let uploadedImage = new Image();
        let icons = [];

        // Preload icon images
        const iconImages = {
            star: new Image(),
            lightning: new Image(),
            skull: new Image()
        };
        iconImages.star.src = 'assets/images/star.png';
        iconImages.lightning.src = 'assets/images/lightning.png';
        iconImages.skull.src = 'assets/images/skull.png';

        // Check if images load successfully
        Object.keys(iconImages).forEach(key => {
            iconImages[key].onload = () => console.log(`${key} icon loaded successfully`);
            iconImages[key].onerror = () => console.error(`${key} icon failed to load at ${iconImages[key].src}`);
        });

        // Handle image upload
        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    uploadedImage.src = event.target.result;
                    uploadedImage.onload = () => {
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        const scale = Math.min(canvas.width / uploadedImage.width, canvas.height / uploadedImage.height);
                        const imgWidth = uploadedImage.width * scale;
                        const imgHeight = uploadedImage.height * scale;
                        ctx.drawImage(uploadedImage, (canvas.width - imgWidth) / 2, (canvas.height - imgHeight) / 2, imgWidth, imgHeight);
                        redrawIcons();
                    };
                    uploadedImage.onerror = () => console.error('Uploaded image failed to load');
                };
                reader.readAsDataURL(file);
            }
        });

        // Handle drag and drop for icons
        document.querySelectorAll('.icon').forEach(icon => {
            icon.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', e.target.dataset.icon);
                e.target.classList.add('dragging');
                console.log(`Dragging ${e.target.dataset.icon}`);
            });
            icon.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
                console.log(`Drag ended for ${e.target.dataset.icon}`);
            });
        });

        canvas.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy'; // Indicate a copy operation
        });

        canvas.addEventListener('drop', (e) => {
            e.preventDefault();
            const iconType = e.dataTransfer.getData('text/plain');
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            // Ensure drop is within canvas bounds
            if (x >= 0 && x <= canvas.width && y >= 0 && y <= canvas.height) {
                icons.push({ type: iconType, x, y });
                console.log(`Dropped ${iconType} at (${x}, ${y})`);
                redrawCanvas();
            } else {
                console.warn('Drop outside canvas bounds');
            }
        });

        // Redraw canvas with image and icons
        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (uploadedImage.src) {
                const scale = Math.min(canvas.width / uploadedImage.width, canvas.height / uploadedImage.height);
                const imgWidth = uploadedImage.width * scale;
                const imgHeight = uploadedImage.height * scale;
                ctx.drawImage(uploadedImage, (canvas.width - imgWidth) / 2, (canvas.height - imgHeight) / 2, imgWidth, imgHeight);
            }
            redrawIcons();
        }

        function redrawIcons() {
            icons.forEach(icon => {
                const img = iconImages[icon.type];
                if (img.complete && img.naturalWidth !== 0) {
                    ctx.drawImage(img, icon.x - 25, icon.y - 25, 50, 50); // Center icon at drop point
                } else {
                    console.warn(`${icon.type} icon not loaded, skipping draw`);
                }
            });
        }
    </script>
</body>
</html>
